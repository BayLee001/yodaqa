<?xml version="1.0" encoding="UTF-8"?>
<analysisEngineDescription xmlns="http://uima.apache.org/resourceSpecifier">
  <frameworkImplementation>org.apache.uima.java</frameworkImplementation>
  <primitive>false</primitive>

  <delegateAnalysisEngineSpecifiers>
    <delegateAnalysisEngine key="AnswerGenerator">
      <import name="cz.brmlab.yodaqa.pipeline.AnswerGenerator"/>
    </delegateAnalysisEngine>
    <delegateAnalysisEngine key="AnswerRanker">
      <import name="cz.brmlab.yodaqa.pipeline.AnswerRanker"/>
    </delegateAnalysisEngine>
    <delegateAnalysisEngine key="InteractiveAnswerPrinter">
      <import name="cz.brmlab.yodaqa.io.interactive.InteractiveAnswerPrinter"/>
    </delegateAnalysisEngine>
  </delegateAnalysisEngineSpecifiers>

  <flowController key="FixedFlowController">
    <import name="org.apache.uima.flow.FixedFlowController"/>
  </flowController>

  <analysisEngineMetaData>
    <name>YodaQA Pipeline Main Aggregate</name>
    <description>The complete YodaQA pipeline</description>

    <flowConstraints>
      <fixedFlow>
        <node>AnswerGenerator</node>
        <node>AnswerRanker</node>
        <node>InteractiveAnswerPrinter</node>
      </fixedFlow>
    </flowConstraints>

    <configurationParameters>
      <configurationParameter>
	<name>ActionForIntermediateSegments</name>
	<description>Tells the flow controller what to do with intermediate segments after they are input to the merger.
	  Valid values are:
	  continue - the CAS continues on to the next element in the flow
	  stop - the CAS will no longer continue in the flow, and will be returned from the aggregate if possible.
	  drop - the CAS will no longer continue in the flow, and will be dropped (not returned from the aggregate) if possible.  -
	  dropIfNewCasProduced (the default) - if the CAS multiplier produced a new CAS as a result of processing this CAS, then this
	  CAS will be dropped.  If not, then this CAS will continue.                      -
	</description>
	<type>String</type>
	<multiValued>false</multiValued>
	<mandatory>false</mandatory>
	<overrides>
	  <parameter>FixedFlowController/ActionAfterCasMultiplier</parameter>
	</overrides>
      </configurationParameter>
    </configurationParameters>

    <configurationParameterSettings>
      <!-- This enables CAS mergers to actually eat up the intermediate CASes. -->
      <nameValuePair>
	<name>ActionForIntermediateSegments</name>
	<value><string>drop</string></value>
      </nameValuePair>
    </configurationParameterSettings>

    <capabilities>
      <capability>
        <inputs/>
        <outputs>
          <type>cz.brmlab.yodaqa.model.FinalAnswer.Answer</type>
        </outputs>
      </capability>
    </capabilities>

    <operationalProperties>
      <modifiesCas>true</modifiesCas>
      <multipleDeploymentAllowed>false</multipleDeploymentAllowed>
      <outputsNewCASes>false</outputsNewCASes>
    </operationalProperties>
  </analysisEngineMetaData>
</analysisEngineDescription>
